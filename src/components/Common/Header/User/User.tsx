import { useEffect, useRef, useState, type FC, type MouseEvent} from "react";
import { FILL_RULE, STROKE_LINECAP, STROKE_LINEJOIN, type IconParams, type Person, type SiteSeparation, type useStateReturned } from "../../../../types";
import { UserSpoilerItem } from "./SpoilerItem";
import { accountPath, favouritesPath, startPath } from "../../../../App";
import { useAppDispatch } from "../../../../store";
import { userSlice } from "../../../../store/user";
import { FavouritesLink } from "./FavouritesLink";
import { useNavigate } from "react-router-dom";

interface UserSpoilerLink{
    functional: string,
    description: string,
    icon: IconParams,
    isLink: true,
}
interface UserSpoilerButton{
    functional: () => void,
    description: string,
    icon: IconParams,
    isLink: false,
}
export type UserSpoilerItem = UserSpoilerLink | UserSpoilerButton;

interface HeaderUserProps{
    ava: string, name: Person, parentCl: string, favourites: SiteSeparation<number[]>,
    isHoveredOnUnactive: useStateReturned<boolean>, isToStart: boolean,
    tabIndex: number | null, closeHeader: (() => void) | undefined
}
export const HeaderUser: FC<HeaderUserProps> = ({
    ava, name, parentCl, favourites, isHoveredOnUnactive, isToStart, tabIndex, closeHeader
}) => {
    const navigate = useNavigate();
    const dispatch = useAppDispatch();
    const spoilerLists: UserSpoilerItem[][] = [
        [
            {
                functional: accountPath, description: "My account", 
                icon: {
                    viewbox: {minX: 0, minY: 0, width: 14.625, height: 15.75}, width: 14.625, height: 15.75,
                    pathes: [{fill: "rgb(17, 34, 17)", fillRule: FILL_RULE.nonzero, stroke: "unset", strokeWidth: "unset", strokeLinecap: STROKE_LINECAP.butt, strokeLinejoin: STROKE_LINEJOIN.miter, d: "M 10.007101,1.14539 C 9.3229014,0.40676 8.3674014,0 7.3127014,0 c -1.06031,0 -2.01902,0.4043 -2.7,1.13836 -0.68836,0.74215 -1.02375,1.75078 -0.945,2.83992 0.1561,2.14875 1.79121,3.89672 3.645,3.89672 1.8538,0 3.4860996,-1.74762 3.6445996,-3.89602 0.0799,-1.07929 -0.2576,-2.08582 -0.9502,-2.83359 z M 13.500201,15.75 H 1.1252014 c -0.16198001,0.0021 -0.32239001,-0.0319 -0.46956001,-0.0996 -0.14717,-0.0677 -0.2774,-0.1673 -0.38122,-0.2917 -0.22852,-0.2732 -0.32063,-0.6462 -0.25242,-1.0234 0.29672,-1.646 1.22273001,-3.0287 2.67820001,-3.9994 C 3.9932514,9.4743 5.6311814,9 7.3127014,9 c 1.6815,0 3.3194996,0.4746 4.6124996,1.3359 1.4555,0.9703 2.3815,2.353 2.6782,3.9991 0.0682,0.3772 -0.0239,0.7502 -0.2524,1.0234 -0.1038,0.1244 -0.234,0.2241 -0.3812,0.2918 -0.1472,0.0678 -0.3076,0.1019 -0.4696,0.0998 z"}]
                }, isLink: true
            },
            {
                functional: "#", description: "Payments", 
                icon: {
                    viewbox: {minX: 0, minY: 0, width: 15.75, height: 12.38}, width: 15.75, height: 12.38,
                    pathes: [{fill: "rgb(17, 34, 17)", fillRule: FILL_RULE.nonzero, stroke: "unset", strokeWidth: "unset", strokeLinecap: STROKE_LINECAP.butt, strokeLinejoin: STROKE_LINEJOIN.miter, d: "m 0,10.4063 c 0,0.5221 0.20742,1.0229 0.57663,1.3921 0.36922,0.3692 0.86998,0.5766 1.39212,0.5766 H 13.7812 c 0.5222,0 1.023,-0.2074 1.3922,-0.5766 0.3692,-0.3692 0.5766,-0.87 0.5766,-1.3921 V 4.99219 H 0 Z M 2.32031,7.7344 c 0,-0.2797 0.11112,-0.54801 0.30891,-0.7458 C 2.82702,6.79081 3.09528,6.67969 3.375,6.67969 h 1.6875 c 0.27972,0 0.54798,0.11112 0.74578,0.30891 0.19779,0.19779 0.30891,0.4661 0.30891,0.7458 v 0.7031 c 0,0.2797 -0.11112,0.548 -0.30891,0.7458 C 5.61048,9.3811 5.34222,9.4922 5.0625,9.4922 H 3.375 C 3.09528,9.4922 2.82702,9.3811 2.62922,9.1833 2.43143,8.9855 2.32031,8.7172 2.32031,8.4375 Z M 13.7812,0 H 1.96875 C 1.44661,0 0.94585,0.20742 0.57663,0.57663 0.20742,0.94585 0,1.4466 0,1.96875 V 2.88281 H 15.75 V 1.96875 C 15.75,1.4466 15.5426,0.94585 15.1734,0.57663 14.8042,0.20742 14.3034,0 13.7812,0 Z"}]
                }, isLink: true
            },
            {
                functional: "#", description: "Settings", 
                icon: {
                    viewbox: {minX: 0, minY: 0, width: 15.75, height: 16.17}, width: 15.75, height: 16.17,
                    pathes: [
                        {fill: "rgb(17, 34, 17)", fillRule: FILL_RULE.evenodd, stroke: "unset", strokeWidth: "unset", strokeLinecap: STROKE_LINECAP.butt, strokeLinejoin: STROKE_LINEJOIN.miter, d: "m 7.8749997,9.773438 c 0.93198,0 1.6875,-0.75552 1.6875,-1.6875 0,-0.93198 -0.75552,-1.6875 -1.6875,-1.6875 -0.93198,0 -1.6875,0.75552 -1.6875,1.6875 0,0.93198 0.75552,1.6875 1.6875,1.6875 z"},
                        {fill: "rgb(17, 34, 17)", fillRule: FILL_RULE.nonzero, stroke: "unset", strokeWidth: "unset", strokeLinecap: STROKE_LINECAP.butt, strokeLinejoin: STROKE_LINEJOIN.miter, d: "m 15.4122,9.632838 -0.0166,-0.0134 -1.1095,-0.8701 c -0.0703,-0.05559 -0.1263,-0.12705 -0.1636,-0.20851 -0.0373,-0.08147 -0.0547,-0.17062 -0.0508,-0.26012 v -0.40641 c -0.0036,-0.08894 0.0141,-0.17744 0.0514,-0.25824 0.0374,-0.0808 0.0933,-0.15158 0.1634,-0.20653 l 1.1091,-0.87047 0.0166,-0.01335 c 0.171,-0.14251 0.2858,-0.34121 0.3238,-0.56058 0.038,-0.21937 -0.0033,-0.44511 -0.1164,-0.63685 l -1.5015,-2.59804 c -0.0018,-0.00245 -0.0033,-0.00504 -0.0046,-0.00774 -0.1138,-0.18908 -0.2902,-0.33235 -0.4986,-0.40492 -0.2084,-0.07257 -0.4356,-0.06986 -0.6422,0.00766 l -0.0123,0.00457 -1.3043,0.52488 c -0.0824,0.03329 -0.1714,0.04653 -0.2599,0.03865 -0.0884,-0.00789 -0.1737,-0.03668 -0.2488,-0.084 -0.1154,-0.07266 -0.2325,-0.14133 -0.3516,-0.20602 -0.0772,-0.04186 -0.1435,-0.10128 -0.1935,-0.17346 -0.05,-0.07218 -0.0824,-0.1551 -0.0944,-0.24208 L 10.3113,0.795938 10.3071,0.770628 C 10.2643,0.555048 10.1487,0.360768 9.9794997,0.220428 9.8103997,0.080092 9.5980997,0.002256 9.3782997,0 h -3.00656 c -0.22287,7.14e-4 -0.43834,0.080057 -0.60845,0.224048 -0.1701,0.144 -0.28393,0.34341 -0.32144,0.5631 l -0.00316,0.01969 -0.19582,1.39465 c -0.01201,0.08673 -0.04411,0.16946 -0.09373,0.2416 -0.04962,0.07214 -0.1154,0.1317 -0.19209,0.17394 -0.11941,0.06432 -0.23666,0.13256 -0.35156,0.20461 -0.07501,0.04704 -0.1601,0.07561 -0.24828,0.08337 -0.08819,0.00776 -0.17696,-0.00551 -0.25903,-0.03872 l -1.30535,-0.52734 -0.01231,-0.00492 c -0.2069,-0.0776 -0.43447,-0.08021 -0.6431,-0.00737 -0.20863,0.07284 -0.38512,0.21652 -0.49877,0.40604 l -0.00457,0.00773 -1.50363002,2.59981 c -0.11334,0.19193 -0.1547,0.41791 -0.1167,0.63755 0.038,0.21963 0.15289,0.41858 0.32412,0.56127 l 0.01652,0.01336 1.10953002,0.87012 c 0.07027,0.05559 0.12634,0.12705 0.16362,0.20851 0.03728,0.08147 0.0547,0.17062 0.05084,0.26012 v 0.40641 c 0.00352,0.08894 -0.01412,0.17744 -0.05146,0.25824 -0.03734,0.0808 -0.09333,0.15158 -0.16335,0.20653 l -1.10918002,0.87049 -0.01652,0.0133 c -0.17106,0.1425 -0.28586,0.3412 -0.32386,0.5606 -0.038,0.2194 0.00327,0.4451 0.11644,0.6369 l 1.50152002,2.598 c 0.00173,0.0025 0.00326,0.005 0.00457,0.0077 0.11377,0.1891 0.29018,0.3324 0.49858,0.405 0.2084,0.0725 0.43563,0.0698 0.64224,-0.0077 l 0.01231,-0.0046 1.30324,-0.5249 c 0.08232,-0.0332 0.17137,-0.0465 0.25982,-0.0386 0.08845,0.0079 0.17375,0.0367 0.24889,0.084 0.11531,0.0729 0.2325,0.1416 0.35156,0.206 0.0772,0.0419 0.14347,0.1013 0.19349,0.1735 0.05001,0.0722 0.08236,0.1551 0.09444,0.2421 l 0.19547,1.3918 0.00422,0.0253 c 0.04285,0.2159 0.15885,0.4105 0.32843,0.5509 0.16958,0.1403 0.38237,0.218 0.60251,0.2197 h 3.00656 c 0.2229,-7e-4 0.4383,-0.08 0.6084,-0.224 0.1701003,-0.144 0.2840003,-0.3434 0.3215003,-0.5631 l 0.0031,-0.0197 0.1959,-1.3946 c 0.0122,-0.0869 0.0445,-0.1698 0.0945,-0.2419 0.0499,-0.0722 0.116,-0.1317 0.193,-0.1737 0.1203,-0.0647 0.2377,-0.1332 0.3516,-0.2046 0.075,-0.047 0.1601,-0.0756 0.2483,-0.0834 0.0882,-0.0077 0.1769,0.0055 0.259,0.0387 l 1.3054,0.5256 0.0123,0.005 c 0.2069,0.0777 0.4345,0.0804 0.6431,0.0075 0.2087,-0.0728 0.3852,-0.2166 0.4987,-0.4062 0.0014,-0.0027 0.003,-0.0053 0.0046,-0.0077 l 1.5015,-2.5977 c 0.1136,-0.192 0.1551,-0.418 0.1172,-0.6377 -0.038,-0.2198 -0.1529,-0.4188 -0.3242,-0.5615 z m -4.7278,-1.41471 c -0.0256,0.54442 -0.2089,1.06971 -0.5275,1.51191 -0.3186003,0.4422 -0.7588003,0.7823 -1.2671003,0.979 -0.50827,0.1967 -1.06276,0.2414 -1.59602,0.1288 -0.53326,-0.1127 -1.02231,-0.3778 -1.40768,-0.7632 -0.38537,-0.3854 -0.65045,-0.8745 -0.76301,-1.40777 -0.11256,-0.53328 -0.06775,-1.08777 0.12898,-1.59605 0.19673,-0.50827 0.5369,-0.94844 0.97916,-1.26698 0.44225,-0.31853 0.96753,-0.5017 1.51195,-0.52724 0.39086,-0.0172 0.78101,0.04711 1.14562,0.18885 0.3647,0.14174 0.6959,0.35781 0.9725,0.63447 0.2766003,0.27666 0.4926003,0.60785 0.6343003,0.97252 0.1417,0.36467 0.206,0.75484 0.1888,1.14569 z"}
                    ]
                }, isLink: true
            }
        ],
        [
            {
                functional: "#", description: "Support", 
                icon: {
                    viewbox: {minX: 0, minY: 0, width: 15.8, height: 15.8}, width: 15.8, height: 15.8,
                    pathes: [{fill: "rgb(17, 34, 17)", fillRule: FILL_RULE.nonzero, stroke: "unset", strokeWidth: "unset", strokeLinecap: STROKE_LINECAP.butt, strokeLinejoin: STROKE_LINEJOIN.miter, d: "m 13.470844,2.334014 c -0.73,-0.73717 -1.5984,-1.32285 -2.5554,-1.72339002 C 9.9584438,0.21008398 8.9318438,0.00257398 7.8943838,2.3977085e-5 6.8569638,-0.00253602 5.8292638,0.19992398 4.8703238,0.59574398 c -0.95894,0.39582 -1.83022,0.97722002 -2.56379,1.71079002 -0.73357,0.73357 -1.31496001,1.60485 -1.71079001,2.56379 -0.39582,0.95894 -0.59827,1.98664 -0.595719997567,3.02406 C 0.00257379,8.931764 0.21008379,9.958464 0.61062379,10.915464 c 0.40054001,0.957 0.98622001,1.8254 1.72339001,2.5553 0.72995,0.7372 1.59836,1.3229 2.55534,1.7234 0.95698,0.4006 1.98367,0.6081 3.02108,0.6106 1.03741,0.0026 2.06511,-0.1999 3.0241102,-0.5957 0.9589,-0.3958 1.8302,-0.9772 2.5637,-1.7108 0.7336,-0.7335 1.315,-1.6048 1.7108,-2.5638 0.3959,-0.9589 0.5983,-1.9866 0.5958,-3.02403 -0.0026,-1.03742 -0.2101,-2.06411 -0.6106,-3.02109 -0.4006,-0.95698 -0.9863,-1.82539 -1.7234,-2.55533 z m -7.8138602,5.71535 c -0.02984,-0.45655 0.08021,-0.91134 0.31548,-1.30374 0.23527,-0.3924 0.58457,-0.70374 1.00133,-0.89253 0.41676,-0.18878 0.88116,-0.24603 1.33129,-0.1641 0.45013,0.08193 0.86456,0.29913 1.18806,0.62264 0.3236,0.32352 0.5408002,0.73798 0.6227002,1.1881 0.0819,0.45013 0.0247,0.91453 -0.1641002,1.33129 -0.1888,0.41674 -0.5002,0.76604 -0.8925,1.00134 -0.39244,0.2353 -0.84724,0.3453 -1.30379,0.3155 -0.54467,-0.0361 -1.05769,-0.2688 -1.44368,-0.6548 -0.38599,-0.386 -0.61867,-0.89903 -0.65479,-1.4437 z m 8.4374602,-2.34281 -3.388,0.20531 c -0.0232,0.00122 -0.0463,-0.00323 -0.0674,-0.01298 -0.021,-0.00974 -0.0394,-0.02447 -0.0535,-0.04292 -0.1825,-0.23912 -0.3962,-0.45277 -0.6353002,-0.63527 -0.0184,-0.0141 -0.0332,-0.03248 -0.0429,-0.05355 -0.0097,-0.02107 -0.0142,-0.04421 -0.013,-0.06739 l 0.2053002,-3.38801 c 0.0013,-0.02208 0.0077,-0.04356 0.0188,-0.06268 0.0112,-0.01912 0.0266,-0.03535 0.0452,-0.04737 0.0186,-0.01203 0.0397,-0.0195 0.0617,-0.02182 0.022,-0.00232 0.0442,5.8e-4 0.0649,0.00847 0.8944,0.34072 1.7067,0.86682 2.3833,1.54374 0.6767,0.67692 1.2025,1.48935 1.5429,2.38392 0.0079,0.02066 0.0108,0.04289 0.0085,0.06489 -0.0023,0.02199 -0.0098,0.04313 -0.0218,0.0617 -0.012,0.01856 -0.0283,0.03403 -0.0474,0.04514 -0.0191,0.01111 -0.0406,0.01756 -0.0627,0.01882 z m -8.3878902,-3.99481 0.20531,3.38801 c 0.00122,0.02318 -0.00323,0.04632 -0.01297,0.06739 -0.00974,0.02107 -0.02448,0.03945 -0.04293,0.05355 -0.23912,0.1825 -0.45277,0.39615 -0.63527,0.63527 -0.01409,0.01845 -0.03247,0.03318 -0.05355,0.04292 -0.02107,0.00975 -0.0442,0.0142 -0.06739,0.01298 l -3.38801,-0.20531 c -0.02208,-0.00126 -0.04355,-0.00771 -0.06268,-0.01882 -0.01912,-0.01111 -0.03535,-0.02658 -0.04737,-0.04514 -0.01202,-0.01857 -0.0195,-0.03971 -0.02182,-0.0617 -0.00232,-0.022 5.9e-4,-0.04423 0.00847,-0.06489 0.34055,-0.89471 0.86658,-1.70722 1.54351,-2.38415 0.67693,-0.67694 1.48945,-1.20296 2.38415,-1.54351 0.02066,-0.00789 0.0429,-0.01079 0.06489,-0.00847 0.022,0.00232 0.04313,0.00979 0.0617,0.02182 0.01856,0.01202 0.03403,0.02825 0.04514,0.04737 0.01112,0.01912 0.01756,0.0406 0.01882,0.06268 z m -3.99481,8.38652 3.38801,-0.2053 c 0.02319,-0.0012 0.04632,0.0032 0.06739,0.013 0.02108,0.0097 0.03946,0.0244 0.05355,0.0429 0.1825,0.2391 0.39615,0.4528 0.63527,0.6353 0.01845,0.0141 0.03319,0.0324 0.04293,0.0535 0.00974,0.0211 0.01419,0.0442 0.01297,0.0674 l -0.20531,3.388 c -0.00126,0.0221 -0.0077,0.0436 -0.01882,0.0627 -0.01111,0.0191 -0.02658,0.0353 -0.04514,0.0474 -0.01857,0.012 -0.0397,0.0195 -0.0617,0.0218 -0.02199,0.0023 -0.04423,-6e-4 -0.06489,-0.0085 -0.8947,-0.3405 -1.70722,-0.8666 -2.38415,-1.5435 -0.67693,-0.6769 -1.20296,-1.4894 -1.54351,-2.3841 -0.00788,-0.0207 -0.01079,-0.0429 -0.00847,-0.0649 0.00232,-0.022 0.0098,-0.0432 0.02182,-0.0617 0.01202,-0.0186 0.02825,-0.0341 0.04737,-0.0452 0.01913,-0.0111 0.0406,-0.0175 0.06268,-0.0188 z m 8.3865002,3.9948 -0.2053002,-3.388 c -0.0012,-0.0232 0.0032,-0.0463 0.013,-0.0674 0.0097,-0.0211 0.0245,-0.0394 0.0429,-0.0535 0.2391002,-0.1825 0.4528002,-0.3962 0.6353002,-0.6353 0.0141,-0.0185 0.0325,-0.0332 0.0535,-0.0429 0.0211,-0.0098 0.0442,-0.0142 0.0674,-0.013 l 3.388,0.2053 c 0.0221,0.0013 0.0436,0.0077 0.0627,0.0188 0.0191,0.0111 0.0354,0.0266 0.0474,0.0452 0.012,0.0185 0.0195,0.0397 0.0218,0.0617 0.0023,0.022 -6e-4,0.0442 -0.0085,0.0649 -0.3405,0.8947 -0.8665,1.7072 -1.5435,2.3841 -0.6769,0.6769 -1.4894,1.203 -2.3841,1.5435 -0.0207,0.0079 -0.0429,0.0108 -0.0649,0.0085 -0.022,-0.0023 -0.0431,-0.0098 -0.0617,-0.0218 -0.0186,-0.0121 -0.034,-0.0283 -0.0452,-0.0474 -0.0111,-0.0191 -0.0175,-0.0406 -0.0188,-0.0627 z"}]
                }, isLink: true
            },
            {
                functional: () => {
                    localStorage.setItem("currentUser", "-1"); dispatch(userSlice.actions.resetUser());
                    if(isToStart) navigate(startPath)
                }, 
                description: "Logout", 
                icon: {
                    viewbox: {minX: 0, minY: 0, width: 14.6, height: 12.4}, width: 14.6, height: 12.4,
                    pathes: [
                        {fill: "rgb(17, 34, 17)", fillRule: FILL_RULE.nonzero, stroke: "unset", strokeWidth: "unset", strokeLinecap: STROKE_LINECAP.butt, strokeLinejoin: STROKE_LINEJOIN.miter, d: "M 3.9375,6.1875 C 3.9375,6.03832 3.99676,5.89524 4.10225,5.78975 4.20774,5.68426 4.35082,5.625 4.5,5.625 H 9.5625 V 1.96875 C 9.5625,0.84375 8.3746,0 7.3125,0 H 1.96875 C 1.44678,5.6e-4 0.94634,0.20816 0.57725,0.57725 0.20816,0.94634 5.6e-4,1.44678 0,1.96875 v 8.43755 c 5.6e-4,0.5219 0.20816,1.0224 0.57725,1.3915 0.36909,0.369 0.86953,0.5766 1.3915,0.5772 h 5.625 c 0.52197,-6e-4 1.02245,-0.2082 1.39155,-0.5772 0.369,-0.3691 0.5766,-0.8696 0.5772,-1.3915 V 6.75 H 4.5 C 4.35082,6.75 4.20774,6.69074 4.10225,6.58525 3.99676,6.47976 3.9375,6.33668 3.9375,6.1875 Z M 14.4601,5.78988 11.6476,2.97738 C 11.5413,2.87635 11.3997,2.82085 11.253,2.82273 11.1063,2.82461 10.9662,2.88371 10.8624,2.98744 10.7587,3.09116 10.6996,3.2313 10.6977,3.37798 10.6959,3.52466 10.7513,3.66627 10.8524,3.77262 L 12.7044,5.625 H 9.5625 V 6.75 h 3.1419 l -1.852,1.8524 c -0.0544,0.0517 -0.098,0.1138 -0.128,0.1826 -0.0301,0.0688 -0.0461,0.1429 -0.047,0.218 -0.001,0.0751 0.0131,0.1496 0.0414,0.2191 0.0283,0.0696 0.0702,0.1327 0.1233,0.1858 0.0531,0.0531 0.1162,0.095 0.1858,0.1233 0.0695,0.0283 0.144,0.0424 0.2191,0.0414 0.0751,-9e-4 0.1492,-0.0169 0.218,-0.047 0.0688,-0.03 0.1309,-0.0736 0.1826,-0.128 l 2.8125,-2.81248 c 0.1054,-0.10548 0.1646,-0.2485 0.1646,-0.39762 0,-0.14912 -0.0592,-0.29214 -0.1646,-0.39762 z"}
                    ]
                }, isLink: false
            }
        ]
    ]

    let [isOpened, setIsOpened] = useState<boolean>(false);
    let container = useRef<HTMLDivElement>(null);
    let list = useRef<HTMLDivElement>(null);
    useEffect(() => {
        const containerHTML = container.current;
        const listHTML = list.current;
        if(containerHTML && listHTML){
            containerHTML.style.height = (isOpened) ? listHTML.offsetHeight + "px" : "0px";
        }
    }, [isOpened]);
    const toggleSpoiler = (e: MouseEvent<HTMLButtonElement>) => {
        setIsOpened(prev => !prev);
        e.currentTarget.blur();
    }
    const showSpoiler = () => setIsOpened(true);
    const hideSpoiler = () => setIsOpened(false);

    let spoilerItemsTabIndexes: number[] = [];
    let spoilerLinksInListCount: number[] = [];
    if(tabIndex === null){
        spoilerItemsTabIndexes = Array.from({length: spoilerLists.reduce(
            (sum, spoilerList) => sum += spoilerList.length, 0
        )}, () => 0);
        spoilerLinksInListCount = [0, ...Array.from({length: spoilerLists.length - 1}, () => 0)];
    } else {
        spoilerItemsTabIndexes = Array.from({length: spoilerLists.reduce(
            (sum, spoilerList) => sum += spoilerList.length, 0
        )}, ((_, i) => tabIndex + 1 + Number(favourites.flightsPart.length !== 0 || favourites.hotelsPart.length !== 0) + i));
        spoilerLinksInListCount = [0, ...spoilerLists.slice(1).map(spoilerList => spoilerList.length)];
    }
    return(
        <div 
            className={[
                `${parentCl}__user`, `user-${parentCl}`, isOpened ? "_active" : ""
            ].filter(Boolean).join(" ")}
        >
            <FavouritesLink
                isActive={
                    (favourites.flightsPart.length !== 0 || favourites.hotelsPart.length !== 0) &&
                    location.pathname !== favouritesPath
                } closeHeader={closeHeader} 
                parentCl={parentCl} isHoveredOnUnactive={isHoveredOnUnactive} tabIndex={tabIndex}
                isHaveFavourites={(favourites.flightsPart.length !== 0 || favourites.hotelsPart.length !== 0)}
            />
            <div className={`user-${parentCl}__line`}>|</div>
            <div className={[`user-${parentCl}__info`, isOpened ? "_spoiler-opened" : ""].join(" ")}>
                <div className={`user-${parentCl}__ava-block`}>
                    <img className={`user-${parentCl}__ava`} src={ava === "" ? "/img/account/user.svg" : ava} alt="Your Ava" />
                </div>
                <button 
                    className={`user-${parentCl}__spoiler-opener opener-spoiler-user-${parentCl}`} type="button"
                    onClick={toggleSpoiler} tabIndex={(tabIndex !== null) 
                        ? tabIndex + Number(favourites.flightsPart.length !== 0 || favourites.hotelsPart.length !== 0) 
                        : 0
                    }
                >
                    <div className={`opener-spoiler-user-${parentCl}__icon-parent`}>
                        <svg className={`opener-spoiler-user-${parentCl}__icon`} viewBox="0 0 11.375 11.375" fill="none">
                            <path fill="rgb(255,134,130)" fillRule="nonzero"  d="M5.6875 0C2.54652 0 0 2.54652 0 5.6875C0 8.82848 2.54652 11.375 5.6875 11.375C8.82848 11.375 11.375 8.82848 11.375 5.6875C11.375 2.54652 8.82848 0 5.6875 0ZM6.65301 8.00324C6.69534 8.04346 6.7292 8.09175 6.75258 8.14527C6.77596 8.19878 6.78839 8.25643 6.78913 8.31482C6.78988 8.37321 6.77893 8.43116 6.75693 8.48525C6.73493 8.53935 6.70232 8.58849 6.66103 8.62978C6.61974 8.67107 6.5706 8.70368 6.5165 8.72568C6.46241 8.74768 6.40446 8.75863 6.34607 8.75788C6.28768 8.75714 6.23003 8.74471 6.17652 8.72133C6.123 8.69795 6.07471 8.66409 6.03449 8.62176L3.40949 5.99676C3.32751 5.91472 3.28145 5.80348 3.28145 5.6875C3.28145 5.57152 3.32751 5.46028 3.40949 5.37824L6.03449 2.75324C6.11721 2.67466 6.22735 2.6315 6.34143 2.63296C6.45551 2.63442 6.56451 2.68039 6.64519 2.76106C6.72586 2.84174 6.77183 2.95074 6.77329 3.06482C6.77476 3.1789 6.73159 3.28904 6.65301 3.37176L4.33754 5.6875L6.65301 8.00324Z" transform="matrix(-4.37114e-08,-1,1,-4.37114e-08,0,11.375)" />
                        </svg>
                    </div>
                </button>
                <output className={`user-${parentCl}__name`}>
                    {name.firstName + " " + name.lastName[0] + "."}
                </output>
            </div>
            <div className={`user-${parentCl}__spoiler spoiler-user-${parentCl}`}>
                <div className={`spoiler-user-${parentCl}__container`} ref={container}>
                    <div className={`spoiler-user-${parentCl}__list`} ref={list}>
                        <div className={`spoiler-user-${parentCl}__info`}>
                            <img className={`spoiler-user-${parentCl}__ava`} src={ava === "" ? "/img/account/user.svg" : ava} alt="Your Ava" />
                            <div className={`spoiler-user-${parentCl}__subava`}>
                                <output className={`spoiler-user-${parentCl}__name`}>{name.firstName + " " + name.lastName + "."}</output>
                                <div className={`spoiler-user-${parentCl}__status`}>Online</div>
                            </div>
                        </div>
                        {spoilerLists.map((spoilerList, i) => 
                            <ul className={`spoiler-user-${parentCl}__links`} key={i}>
                                {spoilerList.map((spoilerLink, j) => 
                                    <UserSpoilerItem 
                                        tabIndex={spoilerItemsTabIndexes[j + spoilerLinksInListCount[i] + i]}
                                        key={j} value={spoilerLink} parentCl={parentCl} 
                                        onFocusHandler={j === 0 ? showSpoiler : undefined}
                                        onBlurHandler={i === spoilerList.length - 1 && j === spoilerList.length - 1 ? () => {hideSpoiler(); closeHeader?.()} : undefined}
                                    />
                                )}
                            </ul>
                        )}
                    </div>
                </div>
            </div>
        </div>
    )
}