import React, { useState, type FC } from "react";
import type { AnotherInputValidation, ConfirmInputValidation } from "../../types";


export interface AuthorizationInputConfirmValue{
    id: string,  subinput: string, placeholder: string, 
    isCanHide: boolean, state: string, setState: (newValue: string) => void, 
    validation: ConfirmInputValidation, passwordValue: string
}
export interface AuthorizationInputAnotherValue{
    id: string, subinput: string, placeholder: string, 
    isCanHide: boolean, state: string, setState: (newValue: string) => void, 
    validation: AnotherInputValidation, passwordValue: null
}
type AuthorizationInputValue = AuthorizationInputAnotherValue | AuthorizationInputConfirmValue;

interface AuthorizationInputProps{
    about: AuthorizationInputValue,
    parentCls: string[],
    isInMassive: boolean
}

export const AuthorizationInput: FC<AuthorizationInputProps> = ({about, parentCls, isInMassive}) => {
    let [isShow, setIsShow] = useState<boolean>(false);
    let [isGood, setIsGood] = useState<boolean>(false);
    let [error, setError] = useState<string>("");
    const toggleIsShow = () => {
        setIsShow(prev => !prev);
    }
    const {id, subinput, placeholder, isCanHide, state, setState, validation, passwordValue} = about;
    
    const makeValidation = () => {
        const validationResults = (passwordValue !== null) ? validation(state, passwordValue) : validation(state);
        setError(validationResults); setIsGood(validationResults === "");
    }
    const nullError = () => {setError(""); setIsGood(false)};

    if(isCanHide){
        return(
            <div 
                className={[
                    ...parentCls.map(cl => cl + "__field"), ...parentCls.map(cl => "field-" + cl),
                    isInMassive ? "in-massive" : "", "password", error !== "" ? "_error" : "",
                    isGood ? "_good" : ""
                ].filter(Boolean).join(" ")}
            >
                <label 
                    className={parentCls.map(cl => "field-" + cl + "__subinput").join(" ")} 
                    htmlFor={id}
                >
                    {subinput}
                </label>
                <input 
                    className={parentCls.map(cl => "field-" + cl + "__input").join(" ")} 
                    id={id} type={isShow ? "text" : "password"} placeholder={placeholder}
                    value={state} onInput={(e) => setState(e.currentTarget.value)}
                    onBlur={makeValidation} onFocus={nullError}
                />
                <button className={[...parentCls.map(cl => "field-" + cl + "__show"), ...parentCls.map(cl => "show-field-" + cl)].join(" ")} onClick={toggleIsShow}>
                    {isShow 
                        ? <svg className={parentCls.map(cl => "show-field-" + cl + "__icon").join(" ")} viewBox="0 0 22.5 15" width="22.5" height="15" fill="none">
                            <path fill="#000000" fillRule="evenodd" d="m 11.25,10.5 c 1.6569,0 3,-1.3431 3,-3 0,-1.6569 -1.3431,-3 -3,-3 -1.6569003,0 -3.0000003,1.3431 -3.0000003,3 0,1.6569 1.3431,3 3.0000003,3 z"/>
                            <path fill="#000000" fillRule="nonzero" d="M 22.2591,6.6844 C 21.0187,4.76625 19.4095,3.13688 17.6058,1.97203 15.6103,0.68203 13.4072,0 11.235,0 9.2418697,0 7.2820297,0.56953 5.4098397,1.69266 3.5006197,2.83781 1.7709297,4.51078 0.26858966,6.6647 0.09898966,6.9081 0.00558366,7.1965 2.4266255e-4,7.4931 -0.00509934,7.7897 0.07786466,8.0813 0.23859066,8.3306 1.4765597,10.268 3.0698397,11.8997 4.8454697,13.0486 6.8446797,14.3438 8.9962497,15 11.235,15 c 2.1895,0 4.3973,-0.6764 6.3844,-1.9556 1.8028,-1.1611 3.4087,-2.7966 4.6443,-4.7307 0.1552,-0.2435 0.2373,-0.5265 0.2365,-0.8153 -9e-4,-0.2888 -0.0846,-0.5713 -0.2411,-0.814 z M 11.2509,12 c -0.89,0 -1.7600003,-0.2639 -2.5000303,-0.7584 -0.74002,-0.4945 -1.3168,-1.1973 -1.65739,-2.0195 -0.3406,-0.8223 -0.42971,-1.7271 -0.25608,-2.6 0.17363,-0.8729 0.60222,-1.67474 1.23155,-2.30408 0.62934,-0.62934 1.43115,-1.05792 2.3040503,-1.23155 0.8729,-0.17364 1.7777,-0.08452 2.6,0.25607 0.8223,0.3406 1.5251,0.91737 2.0195,1.65739 C 15.487,5.74 15.7509,6.61 15.7509,7.5 15.7496,8.6931 15.275,9.8369 14.4314,10.6805 13.5878,11.5241 12.444,11.9986 11.2509,12 Z"/>
                        </svg>
                        : <svg className={parentCls.map(cl => "show-field-" + cl + "__icon").join(" ")} viewBox="0 0 22.5 18" width="22.5" height="18" fill="none">
                            <path fill="#000000" fillRule="nonzero" id="Vector" d="M19.5001 17.9864C19.4016 17.9866 19.304 17.9672 19.213 17.9295C19.122 17.8918 19.0394 17.8364 18.9699 17.7666L2.46994 1.26658C2.33522 1.12478 2.26123 0.93597 2.26373 0.740398C2.26624 0.544827 2.34504 0.357971 2.48334 0.21967C2.62164 0.0813687 2.8085 0.00256547 3.00407 6.15386e-05C3.19964 -0.00244239 3.38845 0.0715513 3.53025 0.206266L20.0303 16.7063C20.1351 16.8112 20.2064 16.9448 20.2354 17.0902C20.2643 17.2356 20.2494 17.3864 20.1927 17.5234C20.1359 17.6604 20.0399 17.7775 19.9166 17.8599C19.7933 17.9423 19.6484 17.9864 19.5001 17.9864ZM10.8751 11.7919L8.44744 9.36423C8.43353 9.35044 8.41565 9.34135 8.3963 9.33824C8.37696 9.33513 8.35713 9.33816 8.3396 9.3469C8.32206 9.35564 8.30771 9.36966 8.29855 9.38697C8.28939 9.40429 8.28589 9.42404 8.28853 9.44345C8.38654 10.0733 8.68227 10.6556 9.13298 11.1063C9.5837 11.5571 10.166 11.8528 10.7959 11.9508C10.8153 11.9534 10.835 11.9499 10.8524 11.9408C10.8697 11.9316 10.8837 11.9173 10.8924 11.8997C10.9012 11.8822 10.9042 11.8624 10.9011 11.843C10.898 11.8237 10.8889 11.8058 10.8751 11.7919ZM11.6251 6.18095L14.0565 8.61142C14.0704 8.62541 14.0883 8.63467 14.1077 8.63789C14.1272 8.64111 14.1471 8.63812 14.1648 8.62935C14.1824 8.62058 14.1969 8.60647 14.206 8.58904C14.2152 8.5716 14.2186 8.55171 14.2159 8.5322C14.1181 7.90152 13.8222 7.31832 13.3709 6.86704C12.9196 6.41575 12.3364 6.11981 11.7057 6.02205C11.6862 6.01903 11.6662 6.02227 11.6486 6.03129C11.631 6.04031 11.6168 6.05466 11.6078 6.07228C11.5989 6.08991 11.5957 6.1099 11.5988 6.12942C11.6019 6.14894 11.6111 6.16697 11.6251 6.18095Z" />
                            <path fill="#000000" fillRule="nonzero" id="Vector" d="M22.2656 9.8002C22.4208 9.55662 22.5029 9.27364 22.502 8.98483C22.5012 8.69601 22.4175 8.41351 22.2609 8.17083C21.0206 6.2527 19.4114 4.62333 17.6077 3.45848C15.6094 2.16848 13.4062 1.48645 11.235 1.48645C10.0904 1.48802 8.9535 1.67465 7.86843 2.03911C7.83807 2.04921 7.81079 2.06691 7.7892 2.09054C7.76761 2.11417 7.75243 2.14292 7.74509 2.17408C7.73776 2.20523 7.73853 2.23774 7.74732 2.26852C7.75611 2.29929 7.77263 2.3273 7.79531 2.34989L10.0097 4.56426C10.0327 4.58731 10.0613 4.60397 10.0927 4.6126C10.1241 4.62123 10.1572 4.62153 10.1887 4.61348C10.9393 4.43057 11.7244 4.44397 12.4683 4.6524C13.2122 4.86083 13.8899 5.25727 14.4362 5.80355C14.9825 6.34983 15.3789 7.02754 15.5873 7.77145C15.7958 8.51536 15.8092 9.30039 15.6262 10.051C15.6183 10.0825 15.6186 10.1155 15.6273 10.1468C15.6359 10.1781 15.6525 10.2066 15.6755 10.2296L18.8606 13.4171C18.8938 13.4503 18.9381 13.4698 18.985 13.4719C19.0319 13.474 19.0778 13.4585 19.1137 13.4283C20.3398 12.3833 21.4022 11.1603 22.2656 9.8002ZM11.25 13.4865C10.5688 13.4865 9.89645 13.3319 9.2837 13.0342C8.67094 12.7366 8.13375 12.3038 7.71263 11.7683C7.29151 11.2329 6.99745 10.6088 6.85262 9.94316C6.70779 9.27752 6.71598 8.58768 6.87656 7.92567C6.88452 7.89419 6.88417 7.86118 6.87555 7.82987C6.86692 7.79856 6.85031 7.77003 6.82734 7.74708L3.69422 4.61254C3.66099 4.57928 3.61649 4.55972 3.56952 4.55772C3.52255 4.55572 3.47655 4.57144 3.44062 4.60176C2.29734 5.57723 1.2375 6.76411 0.268591 8.15114C0.0989903 8.39456 0.00558437 8.68291 0.00024264 8.97954C-0.00509909 9.27618 0.0778646 9.5677 0.238591 9.81707C1.47656 11.7544 3.06937 13.3861 4.84547 14.535C6.84656 15.8302 8.99625 16.4865 11.235 16.4865C12.3912 16.4833 13.5399 16.3007 14.64 15.945C14.6706 15.9353 14.6982 15.9177 14.7202 15.8942C14.7421 15.8707 14.7576 15.8419 14.7652 15.8106C14.7727 15.7794 14.7722 15.7467 14.7634 15.7157C14.7547 15.6847 14.7382 15.6565 14.7155 15.6338L12.4903 13.4091C12.4674 13.3861 12.4388 13.3695 12.4075 13.3609C12.3762 13.3523 12.3432 13.3519 12.3117 13.3599C11.9641 13.4441 11.6077 13.4866 11.25 13.4865Z" />
                        </svg>
                    }
                </button>
                <div 
                    className={[
                        ...parentCls.map(cl => "field-" + cl + "__error-icon"),
                        ...parentCls.map(cl => "error-icon-field-" + cl),
                    ].join(" ")}
                >
                    <svg className={parentCls.map(cl => "error-icon-field-" + cl + "__icon").join(" ")} viewBox="0 0 19.5 19.5" width="19.500000" height="19.500000" fill="none">
                        <path fill="rgb(253,115,110)" fillRule="nonzero" d="M9.75 0C4.37391 0 0 4.37391 0 9.75C0 15.1261 4.37391 19.5 9.75 19.5C15.1261 19.5 19.5 15.1261 19.5 9.75C19.5 4.37391 15.1261 0 9.75 0ZM9.75 14.9958C9.56458 14.9958 9.38332 14.9408 9.22915 14.8378C9.07498 14.7348 8.95482 14.5884 8.88386 14.417C8.81291 14.2457 8.79434 14.0572 8.83051 13.8754C8.86669 13.6935 8.95598 13.5265 9.08709 13.3954C9.2182 13.2643 9.38525 13.175 9.5671 13.1388C9.74896 13.1026 9.93746 13.1212 10.1088 13.1921C10.2801 13.2631 10.4265 13.3833 10.5295 13.5374C10.6325 13.6916 10.6875 13.8729 10.6875 14.0583C10.6875 14.3069 10.5887 14.5454 10.4129 14.7212C10.2371 14.897 9.99864 14.9958 9.75 14.9958ZM10.7681 5.56687L10.4991 11.2856C10.4991 11.4845 10.42 11.6753 10.2794 11.816C10.1387 11.9566 9.94798 12.0356 9.74906 12.0356C9.55015 12.0356 9.35938 11.9566 9.21873 11.816C9.07808 11.6753 8.99906 11.4845 8.99906 11.2856L8.73 5.56969L8.73 5.56734C8.7241 5.42997 8.74607 5.29282 8.79458 5.16415C8.84308 5.03549 8.91713 4.91797 9.01225 4.81868C9.10737 4.71938 9.22161 4.64037 9.34807 4.58639C9.47454 4.53241 9.61062 4.50458 9.74813 4.50458C9.88563 4.50458 10.0217 4.53241 10.1482 4.58639C10.2746 4.64037 10.3889 4.71938 10.484 4.81868C10.5791 4.91797 10.6532 5.03549 10.7017 5.16415C10.7502 5.29282 10.7721 5.42997 10.7662 5.56734L10.7681 5.56687Z" />
                    </svg>
                </div>
                <output className={[...parentCls.map(cl => "field-" + cl + "__error")].join(" ")}>
                    {error}
                </output>
            </div>
        )
    }
    return(
        <div 
            className={[
                ...parentCls.map(cl => cl + "__field"), ...parentCls.map(cl => "field-" + cl), 
                isInMassive ? "in-massive" : "", error !== "" ? "_error" : "",
                isGood ? "_good" : ""
            ].filter(Boolean).join(" ")}
        >
            <label className={parentCls.map(cl => "field-" + cl + "__subinput").join(" ")} htmlFor={id}>{subinput}</label>
            <input 
                className={parentCls.map(cl => "field-" + cl + "__input").join(" ")} id={id} type="text" 
                placeholder={placeholder} 
                value={state} onInput={(e) => setState(e.currentTarget.value)}
                onBlur={makeValidation} onFocus={nullError}
            />
            <output className={[...parentCls.map(cl => "field-" + cl + "__error")].join(" ")}>
                {error}
            </output>
            <div 
                className={[
                    ...parentCls.map(cl => "field-" + cl + "__error-icon"),
                    ...parentCls.map(cl => "error-icon-field-" + cl),
                ].join(" ")}
            >
                <svg className={parentCls.map(cl => "error-icon-field-" + cl + "__icon").join(" ")} viewBox="0 0 19.5 19.5" width="19.500000" height="19.500000" fill="none">
                    <path fill="rgb(253,115,110)" fillRule="nonzero" d="M9.75 0C4.37391 0 0 4.37391 0 9.75C0 15.1261 4.37391 19.5 9.75 19.5C15.1261 19.5 19.5 15.1261 19.5 9.75C19.5 4.37391 15.1261 0 9.75 0ZM9.75 14.9958C9.56458 14.9958 9.38332 14.9408 9.22915 14.8378C9.07498 14.7348 8.95482 14.5884 8.88386 14.417C8.81291 14.2457 8.79434 14.0572 8.83051 13.8754C8.86669 13.6935 8.95598 13.5265 9.08709 13.3954C9.2182 13.2643 9.38525 13.175 9.5671 13.1388C9.74896 13.1026 9.93746 13.1212 10.1088 13.1921C10.2801 13.2631 10.4265 13.3833 10.5295 13.5374C10.6325 13.6916 10.6875 13.8729 10.6875 14.0583C10.6875 14.3069 10.5887 14.5454 10.4129 14.7212C10.2371 14.897 9.99864 14.9958 9.75 14.9958ZM10.7681 5.56687L10.4991 11.2856C10.4991 11.4845 10.42 11.6753 10.2794 11.816C10.1387 11.9566 9.94798 12.0356 9.74906 12.0356C9.55015 12.0356 9.35938 11.9566 9.21873 11.816C9.07808 11.6753 8.99906 11.4845 8.99906 11.2856L8.73 5.56969L8.73 5.56734C8.7241 5.42997 8.74607 5.29282 8.79458 5.16415C8.84308 5.03549 8.91713 4.91797 9.01225 4.81868C9.10737 4.71938 9.22161 4.64037 9.34807 4.58639C9.47454 4.53241 9.61062 4.50458 9.74813 4.50458C9.88563 4.50458 10.0217 4.53241 10.1482 4.58639C10.2746 4.64037 10.3889 4.71938 10.484 4.81868C10.5791 4.91797 10.6532 5.03549 10.7017 5.16415C10.7502 5.29282 10.7721 5.42997 10.7662 5.56734L10.7681 5.56687Z" />
                </svg>
            </div>
        </div>
    )
}